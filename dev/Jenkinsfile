// petclinic dev or main
pipeline {

    parameters {
       choice(name: "environment_project", choices: ["dev", "main"], description: "Environment dir to use for deployment")
       choice(name: "environment_code", choices: ["dev", "main"], description: "Environment dir to use for deployment")
    }


   agent  { label 'maven' }
        options {
                timestamps ()
            }
    stages {
        /*stage('Git checkout project') {
            steps {
                 script{
                        echo '=== start Git chekout project ==='
                        dir("project")
                        {
                            git branch: '${environment_project}', credentialsId: 'jenkis-git-key', url: 'git@github.com:WladimirRogovenko/petclinic-CICD.git'
                        }
                        echo '=== end Git chekout project ==='
                    }
                }
            }
        */
        stage('Git checkout petclinic source') {
            steps {
                 script{
                        echo '=== start Git chekout petclinic source ==='
                        dir("petclinic")
                        {
                            git branch: '${environment_code}', credentialsId: 'jenkis-git-key', url: 'git@github.com:WladimirRogovenko/petclinic.git'
                        }
                        echo '=== end Git chekout petclinic source ==='
                    }
                }
            }
        stage('Build') {
            steps {
               script {
                echo '=== start build petclinic  ===' 
                sh "pwd;cd petclinic; mvn package" 
                echo '=== end build petclinic ==='
                }
               }
            }
        stage ('Tests') {
            steps {
              echo 'some tests must be here ))'  
            }
        }
        stage('Run') {
            steps {
               script {
                echo '=== start run petclinic  ===' 
                sh "pwd;cd petclinic; java -jar target/*.jar --server.port=8082" 
                echo '=== end run petclinic ==='
                sleep(60)
                }
               }
            }            
        }
    }